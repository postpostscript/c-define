<template id="x-instance">
  <script>
    this.__proto__.eval ??= function (code, args = {}) {
      return Function(
        ...Object.keys(args),
        `"use strict";return (${code});`
      ).apply(this, Object.values(args));
    };

    this.$ ??= new Proxy(
      {},
      {
        get: (target, id) => {
          return this.shadowRoot.getElementById(id);
        },
        has: (target, id) => {
          return !!this.shadowRoot.getElementById(id);
        },
      }
    );

    this.__proto__.nextTick ??= function (callback) {
      return new Promise((resolve) => {
        callback && this.methods.push(callback);
        queueMicrotask(async () => {
          await this.init.bind(this);
          resolve();
        });
      });
    };
  </script>
</template>
